---
import dayjs from 'dayjs'
import Carousel from './Carousel.astro'

export interface Props {
  post: any;
  highlighted?: string;
  images?: string[];
}

let { post, highlighted, images } = Astro.props;

// Default placeholder images from public directory
const defaultImages = [
  '/images/chattanooga_guides/performance-arts/tivoli-theatre.jpg',
  '/images/chattanooga_guides/outdoors/cloudland/cloudland-canyon.webp',
  '/images/chattanooga_guides/history/war_canons.webp',
];

const carouselImages = images || post.images || defaultImages;

const pubDate = post.pubDate || post.lastUpdated
const date = new Date(pubDate);
const daysOfWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
const dayOfWeek = daysOfWeek[date.getDay()];

let eventDateDetails;
if (post.eventDatesDetails) {
  const slugFromUrl = post.url?.split('/').pop();

  const slugify = (title) =>
    title
      .toLowerCase()
      .replace(/[^a-z0-9]+/g, '-')
      .replace(/^-|-$/g, '');

  eventDateDetails = post.eventDatesDetails.find(
    (dateObj) =>
      dateObj.date === post.pubDate &&
      slugify(dateObj.eventTitle) === slugFromUrl
  );
}
const subTitle = eventDateDetails && eventDateDetails.eventTitle ? eventDateDetails.eventTitle : dayjs(post.pubDate).format('MM-DD-YYYY');
---

<div class="bg-white border-[1.5px] transition-all duration-75 ease-in-out h-full block relative top-0 hover:-top-2 shadow-lg hover:shadow-xl rounded-xl overflow-hidden" data-test="article-card">
  <!-- Title & Date Section -->
  <a href={post.url} class="block">
    <div class="pt-8 pb-4 px-10">
      <h2 class="font-semi text-3xl leading-tight">
        {post.title}{post.pubDate && (
          `: ${subTitle}`
        )}
      </h2>
      {(post.pubDate || post.lastUpdated) && (
        <p class="text-xl text-gray-600 mt-3 flex items-center">
          {`${dayOfWeek}`} {dayjs(pubDate).format('MM-DD-YYYY')} &nbsp {post.iconPath ? <img class="w-10 h-10 inline-icon" src={post.iconPath} alt="icon" /> : ""}
        </p>
      )}
    </div>
  </a>

  <!-- Carousel Section -->
  <Carousel images={carouselImages} />

  <!-- Tags Section -->
  <div class="flex items-center px-10 pb-6 pt-2 text-lg">
    {post.tags && (
      <div>
        {Array.isArray(post.tags) ? (
          post.tags.map((t) => {
            const highlight = t == highlighted ? 'font-semibold' : ''
            return <a href={`/tag/${t.type}/${t.tag}`} class={`${highlight} transition-all duration-75 h-fit inline pr-2`}><span class="text-customGreen1">#</span>{`${t.tag}`}</a>
          })
        ) : (
          <span>Tags are not an array.</span>
        )}
      </div>
    )}
  </div>
</div>

<style>
  .inline-icon {
    width: 2.5rem;
    height: 2.5rem;
    aspect-ratio: 1;
    object-fit: contain;
  }
</style>