---
// import EmailSignup from './Subscribe/EmailSignup.astro'
import dayjs from 'dayjs'
import PageItemsWrapper from './PageItemsWrapper.astro';

export interface Props {
  // Core post metadata
  title: string;
  pubDate?: string;
  originalDate?: string;
  lastUpdated?: string;
  readTime?: string;
  author?: string;
  description?: string;
  tags?: Array<{ type: string; tag: string }>;

  // Event/venue metadata
  time?: string;
  venue?: string;
  venueDetails?: string;
  address?: string;
  entranceCost?: string;
  eventLink?: string;
  ticketsLink?: string;
  matchedDetails?: any;
  eventDatesDetails?: any;

  // Media
  hero?: string;
  youtube?: string;

  // Additional optional metadata
  seoDescription?: string;
  featured?: boolean;
  geoCoverage?: string;
  neighborhoods?: string[];
  seasonality?: string;
  accessibilityNotes?: string;
  parking?: string;
  kidFriendly?: boolean;
  petFriendly?: boolean;
  bestFor?: string[];
  sources?: string[];
  pageItems?: Array<{
    title: string;
    description: string;
    order: number;
    tags: string[];
  }>;
}

let { address, author, readTime, matchedDetails, eventDatesDetails, eventLink, entranceCost, lastUpdated, originalDate, title, time, pubDate, tags, ticketsLink, venue, venueDetails, hero, youtube,
  // Additional optional metadata
  seoDescription, featured, geoCoverage, neighborhoods, seasonality, accessibilityNotes, parking, kidFriendly, petFriendly, bestFor, sources, pageItems } = Astro.props;
const date = new Date(pubDate);
let eventDateDetails;
// console.log(matchedDetails)
if (matchedDetails) {
  eventDateDetails = matchedDetails;
} else if (eventDatesDetails) {
  eventDateDetails = eventDatesDetails.find((dateObj => dateObj.date == pubDate));
}

console.log(matchedDetails);
const daysOfWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
const dayOfWeek = daysOfWeek[date.getDay()];
const subTitle = eventDateDetails && eventDateDetails.eventTitle ? eventDateDetails.eventTitle : dayjs(pubDate).format('MM-DD-YYYY');
entranceCost = eventDateDetails && eventDateDetails.entranceCost ?  eventDateDetails.entranceCost : entranceCost
time = eventDateDetails && eventDateDetails.time ?  eventDateDetails.time : time
venue = eventDateDetails && eventDateDetails.venue ?  eventDateDetails.venue : venue
address = eventDateDetails && eventDateDetails.address ?  eventDateDetails.address : address
ticketsLink = eventDateDetails && eventDateDetails.ticketsLink ?  eventDateDetails.ticketsLink : ticketsLink
eventLink = eventDateDetails && eventDateDetails.eventLink ?  eventDateDetails.eventLink : eventLink
---
<div class="header-styles mb-10 pt-14 pb-14 lg:flex-wrap md:flex-wrap sm:flex-nowrap text-xl">
  <header class="max-w-5xl content max-w-5xl mx-auto px-3 text-3xl tracking-wide">
    <h2 class="text-xl font-semibold tracking-widest">
      The Chattanooga Guides Series
    </h2>
    <h1 class="break-words" style="font-family: 'Libre Baskerville', serif; font-size: clamp(2.75rem, 5vw, 4.5rem);">{title} {pubDate && (
     `: ${subTitle}`
   )}</h1>
 </header>
  <div class="max-w-5xl content max-w-5xl mx-auto px-3 text-lg">
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-y-1">
      {pubDate ? <div><span class="font-semibold">When:</span> {pubDate} {`(${dayOfWeek})`}</div> : ""}
      {time ? <div><span class="font-semibold">Time:</span> {time}</div> : ""}
      {venue ? <div><span class="font-semibold">Venue:</span> {venue}</div> : ""}
      {venueDetails ? <div><span class="font-semibold">Venue Details:</span> {venueDetails}</div> : ""}
      {address ? <div><span class="font-semibold">Address:</span> {address}</div> : ""}
      {entranceCost ? <div><span class="font-semibold">Entrance Fee:</span> {entranceCost}</div> : ""}
      {author ? <div><span class="font-semibold">Original Author:</span> <a href="/about">{author}</a></div> : ""}
      {readTime ? <div><span class="font-semibold">Read time:</span> {readTime}</div> : ""}
      {lastUpdated ? <div><span class="font-semibold">Last updated:</span> {lastUpdated}</div> : ""}
      {originalDate ? <div><span class="font-semibold">Published on:</span> {originalDate}</div> : ""}
      {geoCoverage ? <div><span class="font-semibold">Geo coverage:</span> {geoCoverage}</div> : ""}
      {neighborhoods && neighborhoods.length ? <div><span class="font-semibold">Neighborhoods:</span> {neighborhoods.join(', ')}</div> : ""}
      {seasonality ? <div><span class="font-semibold">Seasonality:</span> {seasonality}</div> : ""}
      {parking ? <div><span class="font-semibold">Parking:</span> {parking}</div> : ""}
      {accessibilityNotes ? <div><span class="font-semibold">Accessibility:</span> {accessibilityNotes}</div> : ""}
      {(kidFriendly !== undefined) ? <div><span class="font-semibold">Kid friendly:</span> {kidFriendly ? 'Yes' : 'No'}</div> : ""}
      {(petFriendly !== undefined) ? <div><span class="font-semibold">Pet friendly:</span> {petFriendly ? 'Yes' : 'No'}</div> : ""}
      {bestFor && bestFor.length ? <div><span class="font-semibold">Best for:</span> {bestFor.join(', ')}</div> : ""}
    </div>
    <div class="mt-2">
      {eventLink ? <a target="_blank" class="mr-3 underline-pink" href={eventLink}>Event Website</a> : ""}
      {() => { 
        if(ticketsLink && ticketsLink.includes("http")) {
          return <a target="_blank" class="mr-1 underline-pink" href={ticketsLink}>Tickets Link</a>
        } else if (ticketsLink) {
        return <div><b>Tickets Link:</b> {ticketsLink}</div>
        } else {
          ""
        }
      }}
    </div>
    <div class="mt-2">
      {tags && tags.length > 0 && (
        <div>
          {tags.map(tag => {
            return <a class="mr-3 no-underline text-warmGreen" href={`/tag/${tag.type}/${tag.tag}`}><span class="text-white">#</span>{tag.tag}</a>
          })}
        </div>
      )}
    </div>
    {sources && sources.length ? (
      <div class="mt-2">
        <div><b>Sources:</b> {sources.join(', ')}</div>
      </div>
    ) : ""}
  </div>
</div>
<article class="max-w-5xl mx-auto px-3 text-xl tracking-wide">

  <!-- Image -->
  {hero && <img class="rounded-xl mx-auto" style="min-width: 80%;" loading="lazy" src={hero} alt={title} />}

  <!-- YouTube Video -->
  {youtube && <div class="embed-responsive aspect-ratio-16/9 mt-6 lg:mt-12">
    <iframe width="700" height="500" class="embed-responsive-item"
      src={`https://www.youtube.com/embed/${youtube}`} frameborder="0"
      allow="accelerometer; autoplay; encrypted-media; gyroscope;" allowfullscreen></iframe>
  </div>}

  <div>
    {eventDateDetails && eventDateDetails.topDetails && (
      <div>
        {eventDateDetails.topDetails.title && <h2 class="text-2xl font-semibold	pt-12">{eventDateDetails.topDetails.title}</h2>}
        <div style="white-space: pre-wrap;">{eventDateDetails.topDetails.text}</div>
      </div>
    )}
  </div>

  <!-- Page Items -->
  {pageItems && pageItems.length > 0 && (
    <div class="max-w-6xl mx-auto px-3 mt-8 mb-8">
      <PageItemsWrapper pageItems={pageItems.map(item => ({
        title: item.title,
        description: item.description,
        number: item.order,
        tags: item.tags
      }))} />
    </div>
  )}

  <!-- Content -->
  <section class="max-w-6xl mx-auto content font-body">
    <slot />
  </section>

  <div>
    {eventDateDetails && eventDateDetails.bottomDetails && (
      <div>
        <h2 class="text-2xl font-semibold	">{eventDateDetails.bottomDetails.title}</h2>
        <div>{eventDateDetails.bottomDetails.text}</div>
      </div>
    )}
  </div>

  <div>
  </div>
</article>
<style>
  pre {
    padding: 8px 16px;
    overflow: auto;
    border-radius: 4px;
    background: #343434;
  }
  code {
    padding: 4px;
    border-radius: 4px;
    background: #343434;
    font-family: Consolas, Monaco, 'Andale Mono', monospace;
    direction: ltr;
    font-size: 14px;
  }
  pre > code {
    padding: 0;
    line-height: 1.5;
    word-break: normal;
    white-space: pre;
    word-spacing: normal;
    tab-size: 4;
  }
</style>
