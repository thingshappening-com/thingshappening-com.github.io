---
export interface Props {
  items: Array<{
    title: string;
    description: string;
    number: number;
    tags: string[];
    photoOptions?: {
      photos: string[];
      appearance?: 'before' | 'after' | 'inline';
    };
  }>;
}

const { items } = Astro.props;
const sortedItems = items.sort((a, b) => a.number - b.number);
---

<div id="page-items-container">
<div id="clear-filters" class="mb-4 hidden">
  <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm hover:bg-gray-300 transition-colors cursor-pointer">
    Clear filters
  </button>
</div>
{sortedItems.map((item) => (
  <section class="page-item text-xl pb-10" data-tags={item.tags.join(',')}>
    <div>
      {item.photoOptions && item.photoOptions.photos && item.photoOptions.photos.length > 0 && item.photoOptions.appearance === 'before' && (
        <div class="pb-5">
          <div class="flex flex-wrap gap-4">
            {item.photoOptions.photos.map((photo) => (
              <img src={photo} alt={item.title} class="rounded-xl max-w-md h-auto object-cover" loading="lazy" />
            ))}
          </div>
        </div>
      )}
      <h2 class="text-3xl mb-4" style="font-family: 'Libre Baskerville', serif;">
        <span class="text-gray-500 font-normal mr-2">{item.number}.</span>
        {item.title}
        <span class="color-pink ml-1"><b>.</b></span>
      </h2>
      <div class="pb-5">
        {item.description}
      </div>
      {item.photoOptions && item.photoOptions.photos && item.photoOptions.photos.length > 0 && item.photoOptions.appearance === 'inline' && (
        <div class="pb-5">
          <div class="flex flex-wrap gap-4">
            {item.photoOptions.photos.map((photo) => (
              <img src={photo} alt={item.title} class="rounded-xl max-w-md h-auto object-cover" loading="lazy" />
            ))}
          </div>
        </div>
      )}
      <div class="pb-5">
        <div class="flex flex-wrap gap-2">
          {item.tags.map((tag) => (
            <span class="page-item-tag px-3 py-1 text-white rounded-full text-sm cursor-pointer transition-colors" style="background-color: #1a4d2e;" data-tag={tag}>
              #{tag}
            </span>
          ))}
        </div>
      </div>
      {item.photoOptions && item.photoOptions.photos && item.photoOptions.photos.length > 0 && (item.photoOptions.appearance === 'after' || !item.photoOptions.appearance) && (
        <div class="pb-5">
          <div class="flex flex-wrap gap-4">
            {item.photoOptions.photos.map((photo) => (
              <img src={photo} alt={item.title} class="rounded-xl max-w-md h-auto object-cover" loading="lazy" />
            ))}
          </div>
        </div>
      )}
    </div>
  </section>
))}
</div>

<script>
  (function() {
    const container = document.getElementById('page-items-container');
    if (!container) return;
    
    const items = container.querySelectorAll('.page-item');
    const tags = container.querySelectorAll('.page-item-tag');
    const clearFiltersBtn = document.getElementById('clear-filters');
    let activeTag = null;
    
    function resetFilters() {
      activeTag = null;
      items.forEach(item => {
        item.style.display = '';
      });
      tags.forEach(t => {
        t.style.backgroundColor = '#1a4d2e';
        t.classList.add('text-white');
      });
      if (clearFiltersBtn) {
        clearFiltersBtn.classList.add('hidden');
      }
    }
    
    function applyFilter(tagName) {
      activeTag = tagName;
      items.forEach(item => {
        const itemTags = item.getAttribute('data-tags').split(',');
        if (itemTags.includes(tagName)) {
          item.style.display = '';
        } else {
          item.style.display = 'none';
        }
      });
      tags.forEach(t => {
        if (t.getAttribute('data-tag') === tagName) {
          t.style.backgroundColor = '#3CB371';
        } else {
          t.style.backgroundColor = '#1a4d2e';
        }
      });
      if (clearFiltersBtn) {
        clearFiltersBtn.classList.remove('hidden');
      }
    }
    
    if (clearFiltersBtn) {
      clearFiltersBtn.querySelector('button').addEventListener('click', resetFilters);
    }
    
    tags.forEach(tag => {
      tag.addEventListener('click', function() {
        const clickedTag = this.getAttribute('data-tag');
        
        // Toggle: if same tag clicked, show all; otherwise filter
        if (activeTag === clickedTag) {
          resetFilters();
        } else {
          applyFilter(clickedTag);
        }
      });
    });
  })();
</script>

<style>
  .page-item-tag:hover {
    background-color: #3CB371 !important;
  }
</style>

