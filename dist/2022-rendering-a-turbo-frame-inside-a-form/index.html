<!DOCTYPE html><html lang="en"> <head><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-2K6JP8M5XE"></script>  <meta charset="utf-8"> <meta name="viewport" content="width=device-width"> <link rel="sitemap" href="/sitemap.xml"> <link rel="icon" type="image/x-icon" href="/images/favicon.ico">  <meta name="description" content="How to render turbo frames within a multi-part form"> <meta property="og:type" content="website"> <meta property="og:url" content="https://tinytechtuts.com"> <meta property="og:title" content="How to render turbo frames within a multi-part form"> <meta property="og:description" content="How to render turbo frames within a multi-part form"> <meta property="og:image" content="/images/social.jpg"> <meta property="twitter:card" content="summary_large_image"> <meta property="twitter:url" content="https://tinytechtuts.com"> <meta property="twitter:title" content="How to render turbo frames within a multi-part form"> <meta property="twitter:description" content="How to render turbo frames within a multi-part form"> <meta property="twitter:image" content="/images/social.jpg"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism-tomorrow.min.css"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/plugins/toolbar/prism-toolbar.min.css"> <link href="https://fonts.googleapis.com/css2?family=Londrina+Solid:wght@900&family=Poppins:ital,wght@0,400;0,600;1,400;1,700&display=swap" rel="stylesheet"> <title>How to render turbo frames within a multi-part form</title><style>pre[data-astro-cid-xj2uyz6m]{padding:8px 16px;overflow:auto;border-radius:4px;background:#343434}code[data-astro-cid-xj2uyz6m]{padding:4px;border-radius:4px;background:#343434;font-family:Consolas,Monaco,Andale Mono,monospace;direction:ltr;font-size:14px}pre[data-astro-cid-xj2uyz6m]>code[data-astro-cid-xj2uyz6m]{padding:0;line-height:1.5;word-break:normal;white-space:pre;word-spacing:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4}
</style>
<link rel="stylesheet" href="/_astro/2020-add-sitemap-to-phoenix-elixir-project.A85XpehK.css" /><script type="module" src="/_astro/hoisted.tlrkCr7x.js"></script></head> <body> <nav> <div class="max-w-5xl mx-auto px-3 py-3 flex items-center justify-between h-16"> <a href="/" class="font-bold text-xl hover:text-hot-pink">TinyTechTuts</a> <a href="/search" class=""> <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path> </svg> </a> </div> <div class="w-full border-b-2 border-black squiggle"></div> </nav> <main class="py-12 lg:py-20"> <article class="max-w-5xl mx-auto px-3" data-astro-cid-xj2uyz6m> <header style="margin: 0 !important" class="mx-auto max-w-3xl text-center content" data-astro-cid-xj2uyz6m> <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2976969447542443" crossorigin="anonymous"></script> <meta name="google-adsense-account" content="ca-pub-2976969447542443"> <h1 data-astro-cid-xj2uyz6m>How to render turbo frames within a multi-part form</h1> </header> <!-- Image -->  <!-- YouTube Video -->  <!-- Content --> <section style="margin: 0 !important" class="max-w-3xl mx-auto py-6 lg:py-12 content" data-astro-cid-xj2uyz6m>  <p>This is a code example of how to render a Turbo Frame within an html form. This is going to be an application that handles orders. You will need to generate an application and create the orders controller and order model. This was the command I used to generate this application, it uses esbuild for javascript and tailwind for the css. This is an example application I built to get exposure to Turbo.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">rails </span><span style="color:#F97583">new</span><span style="color:#E1E4E8"> kitchen </span><span style="color:#F97583">-</span><span style="color:#E1E4E8">j esbuild </span><span style="color:#F97583">--</span><span style="color:#E1E4E8">css tailwind</span></span></code></pre>
<p>The application functionality this examples is a multi-part form, which will show a new turbo frame for each step of the order the user has progressed to.</p>
<p>This is what my migration change method looked like for the orders model:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">def</span><span style="color:#B392F0"> change</span></span>
<span class="line"><span style="color:#E1E4E8">  create_table </span><span style="color:#79B8FF">:orders</span><span style="color:#F97583"> do</span><span style="color:#E1E4E8"> |t|</span></span>
<span class="line"><span style="color:#E1E4E8">    t.string </span><span style="color:#79B8FF">:name</span></span>
<span class="line"><span style="color:#E1E4E8">    t.json </span><span style="color:#79B8FF">:toppings</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">array:</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">default:</span><span style="color:#E1E4E8"> []</span></span>
<span class="line"><span style="color:#E1E4E8">    t.integer </span><span style="color:#79B8FF">:step</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">default:</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    t.timestamps</span></span>
<span class="line"><span style="color:#F97583">  end</span></span>
<span class="line"><span style="color:#F97583">end</span></span></code></pre>
<p>Then add a standard rails route and controller action to handle the incoming request that will render the html with the turbo frame(s).</p>
<p>routes.rb</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#79B8FF">Rails</span><span style="color:#E1E4E8">.application.routes.draw </span><span style="color:#F97583">do</span></span>
<span class="line"><span style="color:#E1E4E8">  resources </span><span style="color:#79B8FF">:orders</span></span>
<span class="line"><span style="color:#F97583">end</span></span></code></pre>
<p>One thing to call out in the controller is on every update we redirect to the edit route so that the user can continue to fill out the multi-part form, until they hit the end of the steps in the form.</p>
<p>orders_controller.rb</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> OrdersController</span><span style="color:#F97583"> &#x3C;</span><span style="color:#B392F0"> ApplicationController</span></span>
<span class="line"><span style="color:#E1E4E8">  before_action </span><span style="color:#79B8FF">:set_order</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">only:</span><span style="color:#F97583"> %</span><span style="color:#E1E4E8">i[ edit ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  def</span><span style="color:#B392F0"> edit</span></span>
<span class="line"><span style="color:#F97583">  end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  def</span><span style="color:#B392F0"> update</span></span>
<span class="line"><span style="color:#E1E4E8">    order </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> @order.update(order_params)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> @order.step </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 2</span></span>
<span class="line"><span style="color:#F97583">      return</span><span style="color:#E1E4E8"> head </span><span style="color:#79B8FF">:ok</span></span>
<span class="line"><span style="color:#F97583">    end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    respond_to </span><span style="color:#F97583">do</span><span style="color:#E1E4E8"> |</span><span style="color:#79B8FF">format</span><span style="color:#E1E4E8">|</span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#E1E4E8"> order</span></span>
<span class="line"><span style="color:#79B8FF">        format</span><span style="color:#E1E4E8">.html { redirect_to edit_order_path(@order), </span><span style="color:#79B8FF">notice:</span><span style="color:#9ECBFF"> "Order was successfully updated."</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#79B8FF">        format</span><span style="color:#E1E4E8">.json { render </span><span style="color:#79B8FF">:show</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">status:</span><span style="color:#79B8FF"> :ok</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">location:</span><span style="color:#E1E4E8"> @order }</span></span>
<span class="line"><span style="color:#F97583">      else</span></span>
<span class="line"><span style="color:#79B8FF">        format</span><span style="color:#E1E4E8">.html { render </span><span style="color:#79B8FF">:edit</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">status:</span><span style="color:#79B8FF"> :unprocessable_entity</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#79B8FF">        format</span><span style="color:#E1E4E8">.json { render </span><span style="color:#79B8FF">json:</span><span style="color:#E1E4E8"> @order.errors, </span><span style="color:#79B8FF">status:</span><span style="color:#79B8FF"> :unprocessable_entity</span><span style="color:#E1E4E8"> }</span></span>
<span class="line"><span style="color:#F97583">      end</span></span>
<span class="line"><span style="color:#F97583">    end</span></span>
<span class="line"><span style="color:#F97583">  end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  def</span><span style="color:#B392F0"> set_order</span></span>
<span class="line"><span style="color:#E1E4E8">      @order </span><span style="color:#F97583">=</span><span style="color:#79B8FF"> Order</span><span style="color:#E1E4E8">.find(params[</span><span style="color:#79B8FF">:id</span><span style="color:#E1E4E8">])</span></span>
<span class="line"><span style="color:#F97583">  end</span></span>
<span class="line"><span style="color:#F97583">end</span></span></code></pre>
<p>Below is the orders model, which contains some hard coded data we will use in our template to render html options for checkboxes. Remember this is an example application, the data for TOPPINGS and EXTRAS should really be stored in a database.</p>
<p>This model also contains a callback to increment each step on update. The <code>order#step</code> will be used to dyamically render the correct partial for the mutlti-step form.</p>
<p>order.rb</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> Order</span><span style="color:#F97583"> &#x3C;</span><span style="color:#B392F0"> ApplicationRecord</span></span>
<span class="line"><span style="color:#79B8FF">  TOPPINGS</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">"perpperoni"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"sausage"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"red onion"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"banana peppers"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"anchovies"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#79B8FF">  EXTRAS</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [</span><span style="color:#9ECBFF">"extra cheese"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"brownie"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"breadsticks"</span><span style="color:#E1E4E8">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  before_update </span><span style="color:#79B8FF">:increment_step</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  private</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  def</span><span style="color:#B392F0"> increment_step</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#F97583"> if</span><span style="color:#E1E4E8"> step </span><span style="color:#F97583">==</span><span style="color:#79B8FF"> 2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">    self</span><span style="color:#E1E4E8">.step </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> step </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span></span>
<span class="line"><span style="color:#F97583">  end</span></span>
<span class="line"><span style="color:#F97583">end</span></span></code></pre>
<p>Then in the edit template render the form partial for order while passing in a local order variable:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">&#x3C;%=</span><span style="color:#E1E4E8"> render </span><span style="color:#79B8FF">partial:</span><span style="color:#9ECBFF"> "form"</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">locals:</span><span style="color:#E1E4E8"> { </span><span style="color:#79B8FF">order:</span><span style="color:#E1E4E8"> @order } </span><span style="color:#9ECBFF">%></span></span></code></pre>
<p>This is the standard scaffolded form for the orders views, but within it there is rendered, step. Based off of the step of the process the order is in, we will render a differ turbo frame within the form.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">&#x3C;%=</span><span style="color:#E1E4E8"> form_with(</span><span style="color:#79B8FF">model:</span><span style="color:#E1E4E8"> order) </span><span style="color:#F97583">do</span><span style="color:#E1E4E8"> |form| </span><span style="color:#9ECBFF">%></span></span>
<span class="line"><span style="color:#9ECBFF">  &#x3C;% if order.errors.any? %></span></span>
<span class="line"><span style="color:#F97583">    &#x3C;</span><span style="color:#E1E4E8">div style</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"color: red"</span><span style="color:#F97583">></span></span>
<span class="line"><span style="color:#F97583">      &#x3C;</span><span style="color:#E1E4E8">h2></span><span style="color:#F97583">&#x3C;%=</span><span style="color:#E1E4E8"> pluralize(order.errors.count, </span><span style="color:#9ECBFF">"error"</span><span style="color:#E1E4E8">) </span><span style="color:#9ECBFF">%> prohibited this order from being saved:&#x3C;/h2></span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">      &#x3C;</span><span style="color:#E1E4E8">ul</span><span style="color:#F97583">></span></span>
<span class="line"><span style="color:#F97583">        &#x3C;%</span><span style="color:#E1E4E8"> order.errors.each </span><span style="color:#F97583">do</span><span style="color:#E1E4E8"> |error| </span><span style="color:#9ECBFF">%></span></span>
<span class="line"><span style="color:#9ECBFF">          &#x3C;li></span><span style="color:#F97583">&#x3C;%=</span><span style="color:#E1E4E8"> error.full_message </span><span style="color:#9ECBFF">%>&#x3C;/li></span></span>
<span class="line"><span style="color:#F97583">        &#x3C;%</span><span style="color:#F97583"> end</span><span style="color:#9ECBFF"> %></span></span>
<span class="line"><span style="color:#9ECBFF">      &#x3C;/ul></span></span>
<span class="line"><span style="color:#F97583">    &#x3C;/</span><span style="color:#E1E4E8">div</span><span style="color:#F97583">></span></span>
<span class="line"><span style="color:#F97583">  &#x3C;%</span><span style="color:#F97583"> end</span><span style="color:#9ECBFF"> %></span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF">  &#x3C;%= render partial: "orders/steps/step_</span><span style="color:#9ECBFF">#{</span><span style="color:#E1E4E8">@step</span><span style="color:#F97583"> ?</span><span style="color:#E1E4E8"> @step</span><span style="color:#9ECBFF"> : order.step}</span><span style="color:#9ECBFF">", locals: { order: order, form: form } %></span></span>
<span class="line"><span style="color:#F97583">&#x3C;%</span><span style="color:#F97583"> end</span><span style="color:#9ECBFF"> %></span></span></code></pre>
<p>What follows are examples of two the step partials. In each of the individual partials we do a few things:</p>
<ol>
<li>Create a turbo frame using the <code>turbo_frame_tag</code> method.</li>
<li>Create a unique id for the tag using the <code>dom_id</code> method and passing it arguments of <code>order</code> and the attribute on the order this specific tag is associate with, <code>"name"</code>. Pass the resulting value as the first argument to <code>turbo_frame_tag</code>.</li>
<li>The html input for the part of the order the frame is associated with and a submit button (this could also be a partial).</li>
</ol>
<p>It will be used by rails to make sure it is both grabbing the correct html on the other side of the turbo frame and then again use it to populate the html reponse within the correct frame.</p>
<p>/views/orders/partials/steps/step_1.rb</p>
<p>Step 1</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">h1</span><span style="color:#F97583">></span><span style="color:#79B8FF">Name</span><span style="color:#F97583">&#x3C;/</span><span style="color:#E1E4E8">h1</span><span style="color:#F97583">></span></span>
<span class="line"><span style="color:#F97583">&#x3C;%</span><span style="color:#E1E4E8"> name_frame_id </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> dom_id(order, </span><span style="color:#9ECBFF">"name"</span><span style="color:#E1E4E8">) </span><span style="color:#9ECBFF">%></span></span>
<span class="line"><span style="color:#9ECBFF">&#x3C;%= turbo_frame_tag name_frame_id, data: { turbo_frame: name_frame_id } do %></span></span>
<span class="line"><span style="color:#F97583">  &#x3C;%=</span><span style="color:#E1E4E8"> form.text_field </span><span style="color:#79B8FF">:name</span><span style="color:#9ECBFF"> %></span></span>
<span class="line"><span style="color:#9ECBFF">  &#x3C;%= form.submit "Continue Order" %></span></span>
<span class="line"><span style="color:#F97583">&#x3C;%</span><span style="color:#F97583"> end</span><span style="color:#9ECBFF"> %></span></span></code></pre>
<p>/views/orders/partials/steps/step_2.rb</p>
<p>Step 2</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">h1</span><span style="color:#F97583">></span><span style="color:#79B8FF">Toppings</span><span style="color:#F97583">&#x3C;/</span><span style="color:#E1E4E8">h1</span><span style="color:#F97583">></span></span>
<span class="line"><span style="color:#F97583">&#x3C;%</span><span style="color:#E1E4E8"> toppings_frame_id </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> dom_id(order, </span><span style="color:#9ECBFF">"toppings"</span><span style="color:#E1E4E8">) </span><span style="color:#9ECBFF">%></span></span>
<span class="line"><span style="color:#9ECBFF">&#x3C;%= turbo_frame_tag toppings_frame_id, data: { turbo_frame: toppings_frame_id } do %></span></span>
<span class="line"><span style="color:#F97583">  &#x3C;%</span><span style="color:#79B8FF"> Order</span><span style="color:#E1E4E8">::</span><span style="color:#79B8FF">TOPPINGS</span><span style="color:#E1E4E8">.each </span><span style="color:#F97583">do</span><span style="color:#E1E4E8"> |topping| </span><span style="color:#9ECBFF">%></span></span>
<span class="line"><span style="color:#9ECBFF">    &#x3C;br /></span></span>
<span class="line"><span style="color:#F97583">    &#x3C;%=</span><span style="color:#E1E4E8"> form.check_box </span><span style="color:#79B8FF">:toppings</span><span style="color:#E1E4E8">, {</span><span style="color:#79B8FF">multiple:</span><span style="color:#79B8FF"> true</span><span style="color:#E1E4E8">}, topping, </span><span style="color:#79B8FF">false</span><span style="color:#9ECBFF"> %></span></span>
<span class="line"><span style="color:#9ECBFF">    &#x3C;%= form.label topping %></span></span>
<span class="line"><span style="color:#F97583">  &#x3C;%</span><span style="color:#F97583"> end</span><span style="color:#9ECBFF"> %></span></span>
<span class="line"><span style="color:#9ECBFF">  &#x3C;%= form.submit "Continue Order" %></span></span>
<span class="line"><span style="color:#F97583">&#x3C;%</span><span style="color:#F97583"> end</span><span style="color:#9ECBFF"> %></span></span></code></pre>
<p>Now when you submit each form it will hit the update action in the controller async using Turbo Drive and redirect you to the edit path as long as the order still has steps to complete (in this example we stop the steps at 2).</p>
<p>Further reading:</p>
<ul>
<li><a href="https://tinytechtuts.com/2022-how-to-replace-string-content-in-ruby/">How to replace the contents of a string in Ruby</a></li>
</ul>  </section> <div data-astro-cid-xj2uyz6m> <!-- sidebar vertical --> <script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2976969447542443" crossorigin="anonymous"></script> <ins class="adsbygoogle" style="position: absolute; right: 50px; top: 200px; width: 300px; height: 1000px;" data-ad-client="ca-pub-2976969447542443" data-ad-slot="1095168865" data-ad-format="auto" data-full-width-responsive="true" data-astro-cid-xj2uyz6m></ins>  </div> </article>  </main> </body></html>